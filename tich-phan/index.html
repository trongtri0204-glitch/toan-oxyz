<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Ki·ªÉm Tra T√≠ch Ph√¢n - ThS. Tr·∫ßn Tr·ªçng Tr·ªã</title>
    <script>
      window.MathJax = { tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] }, options: { processHtmlClass: 'mathjax-process' } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --bg: #0d1117; --card: #161b22; --accent: #58a6ff; --text: #c9d1d9; --correct: #238636; --wrong: #da3633; --gold: #f1c40f; --ai: #8a2be2; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; user-select: none; }
        header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--accent); width: 100%; padding-bottom: 15px; }
        #nameModal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .name-box { background: var(--card); padding: 40px; border-radius: 15px; text-align: center; border: 2px solid var(--accent); max-width: 400px; }
        .name-input { padding: 12px; width: 80%; font-size: 1.1rem; border-radius: 6px; border: 1px solid var(--accent); margin-bottom: 20px; background: #0d1117; color: white; outline: none; }
        .game-container { max-width: 1050px; width: 100%; display: grid; grid-template-columns: 1fr 380px; gap: 20px; }
        @media (max-width: 850px) { .game-container { grid-template-columns: 1fr; } }
        .quiz-card { background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid #30363d; min-height: 580px; display: flex; flex-direction: column; }
        .part-header { color: var(--gold); font-weight: bold; background: #21262d; padding: 10px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid var(--gold); }
        .question-title { color: var(--accent); font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; display: block; }
        .question-text { font-size: 1.1rem; margin-bottom: 20px; line-height: 1.8; text-align: justify; }
        .options-grid { display: grid; gap: 10px; flex-grow: 1; }
        .btn { background: #21262d; border: 1px solid #30363d; color: var(--text); padding: 12px 20px; border-radius: 8px; cursor: pointer; text-align: left; transition: 0.3s; font-size: 1rem; }
        .btn.selected { background: #30363d; border-color: var(--accent); border-width: 2px; }
        .tf-row { display: flex; align-items: center; justify-content: space-between; background: #0d1117; padding: 10px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #30363d; }
        .btn-tf { padding: 6px 12px; border: 1px solid #30363d; border-radius: 4px; cursor: pointer; background: #21262d; color: #fff; }
        .btn-tf.active-t { background: var(--correct); }
        .btn-tf.active-f { background: var(--wrong); }
        .answer-display { background: #000; color: var(--accent); font-size: 2.2rem; padding: 10px; border-radius: 8px; border: 2px solid var(--accent); min-width: 180px; text-align: center; height: 50px; display: flex; align-items: center; justify-content: center; font-family: monospace; }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .num-btn { background: #30363d; border: 1px solid var(--accent); color: #fff; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; }
        .image-box { position: relative; width: 350px; height: 260px; border: 4px solid var(--card); border-radius: 12px; overflow: hidden; margin: 0 auto; background: #000; }
        .grid-overlay { position: absolute; top:0; left:0; width: 100%; height: 100%; display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(4, 1fr); z-index: 100; }
        .tile { background: #2c3e50; border: 1px solid var(--bg); transition: 0.6s; }
        .tile.open { opacity: 0; transform: scale(0.1); pointer-events: none; }
        .status { margin-top: 20px; background: var(--card); padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #30363d; }
        .next-btn { margin-top: 20px; width: 100%; padding: 15px; background: var(--gold); color: #000; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .img-container { text-align: center; margin: 15px 0; background: white; padding: 10px; border-radius: 8px; border: 1px solid #ddd; }
        .img-container img { max-height: 200px; }
        
        /* PH·∫¶N L·ªúI GI·∫¢I M·ªöI */
        #final-area { display: none; width: 100%; max-width: 1050px; }
        .sol-card { background: var(--card); padding: 25px; border-radius: 12px; margin-top: 25px; border: 1px solid #30363d; position: relative; }
        .ai-btn { background: linear-gradient(45deg, #4b0082, #8a2be2); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; margin-top: 15px; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .ai-btn:hover { transform: scale(1.05); box-shadow: 0 0 15px var(--ai); }
        .ai-sol-box { display: none; background: #0d1117; padding: 20px; border-radius: 10px; border-left: 4px solid var(--ai); margin-top: 15px; line-height: 1.8; animation: fadeIn 0.5s; }
        .screenshot-btn { background: #444; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; margin-top: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="nameModal">
    <div class="name-box">
        <h2 style="color:var(--gold)">H·ªÜ TH·ªêNG KI·ªÇM TRA</h2>
        <p>ThS. Tr·∫ßn Tr·ªçng Tr·ªã - GV Chuy√™n To√°n Tr∆∞·ªùng THPT Gia ƒê·ªãnh</p>
        <input type="text" id="studentName" class="name-input" placeholder="Nh·∫≠p H·ªç v√† T√™n h·ªçc sinh...">
        <button class="btn" style="text-align:center; width:100%; background:var(--accent); color:white" onclick="startGame()">B·∫ÆT ƒê·∫¶U</button>
    </div>
</div>

<header>
    <h1 style="color:var(--gold)">CHINH PH·ª§C T√çCH PH√ÇN 12</h1>
    <p>ThS. Tr·∫ßn Tr·ªçng Tr·ªã - GV Chuy√™n To√°n Tr∆∞·ªùng THPT Gia ƒê·ªãnh</p>
</header>

<div class="game-container" id="game-main">
    <div class="quiz-card">
        <div id="part-info" class="part-header"></div>
        <span id="q-title" class="question-title"></span>
        <div id="q-area" class="mathjax-process">
            <div id="q-text" class="question-text"></div>
            <div id="ans-zone" class="options-grid"></div>
        </div>
        <button id="next-btn" class="next-btn" onclick="handleNext()">X√ÅC NH·∫¨N & TI·∫æP THEO ‚ûú</button>
    </div>

    <div class="sidebar">
        <div class="image-box">
            <img src="hinh_game.jpg" style="width:100%; height:100%; object-fit:cover" onerror="this.src='https://via.placeholder.com/350x260?text=Euler'">
            <div id="grid" class="grid-overlay"></div>
        </div>
        <div class="status">
            <div style="font-size: 1.5rem; color: var(--gold);">ƒêI·ªÇM: <span id="score">0.00</span> / 10</div>
            <div id="student-display" style="color:var(--accent); margin: 5px 0;">H·ªçc sinh: ...</div>
            <div style="color: #8b949e;">T·ªïng ti·∫øn ƒë·ªô: <span id="total-q">1</span> / 22</div>
        </div>
    </div>
</div>

<div id="final-area" class="mathjax-process">
    <div style='text-align:center; padding:30px; background:var(--card); border-radius:15px; border:2px solid var(--gold); margin-bottom: 30px;'>
        <h2 style='color:var(--gold); margin-top:0;'>HO√ÄN TH√ÄNH B√ÄI THI</h2>
        <h3 style='color:var(--accent)' id="final-score-display"></h3>
        <p>H·ªçc sinh c√≥ th·ªÉ xem l·∫°i ƒë·ªÅ v√† nh·∫•p v√†o n√∫t AI ƒë·ªÉ xem ph√¢n t√≠ch chi ti·∫øt.</p>
    </div>
    <div id="sol-content"></div>
    <button class="btn" style="margin: 40px 0; width:100%; text-align:center" onclick="location.reload()">QUAY L·∫†I TRANG CH·ª¶</button>
</div>

<script>
    // Ch·∫∑n ph√≠m t·∫Øt ki·ªÉm tra
    document.onkeydown = function(e) { if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && e.keyCode == 85)) return false; };

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyu-MpFNTly4cIhVq0cv2YclWmyLtxjQllhss1LzBr2p3vtC02F83Suhh9rUdIoNBzRww/exec";
    let studentName = "", currentIdx = 0, score = 0, userAns = "", v2Ans = [], selectedV1 = null;

    const questions = [
        // V√≤ng 1
        { part: 1, type: 'v1', num: 1, q: "M·ªánh ƒë·ªÅ n√†o d∆∞·ªõi ƒë√¢y l√† <b>sai</b>?", a: ["$\\displaystyle \\int f'(x) dx = f(x)+C$", "$\\displaystyle \\int [f(x)+g(x)] dx = \\int f(x)dx + \\int g(x)dx$", "$\\displaystyle \\int k f(x) dx = k \\int f(x)dx$", "$\\displaystyle \\int [f(x)-g(x)] dx = \\int f(x)dx - \\int g(x)dx$"], c: "Mg==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>‚Ä¢ Kh·∫≥ng ƒë·ªãnh C <b>Sai</b> v√¨ h·∫±ng s·ªë $k$ ph·∫£i th·ªèa m√£n ƒëi·ªÅu ki·ªán $k \\neq 0$. <br>‚Ä¢ <i>Ch·ª©ng minh:</i> N·∫øu $k=0$, v·∫ø tr√°i l√† $\\int 0 dx = C$, v·∫ø ph·∫£i l√† $0 \\cdot \\int f(x)dx = 0$. Hai v·∫ø kh√¥ng nh·∫•t thi·∫øt b·∫±ng nhau." },
        { part: 1, type: 'v1', num: 2, q: "Nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = \\cos x$ l√†:", a: ["$-\\sin x + C$", "$\\sin x + C$", "$\\cos x + C$", "$-\\cos x + C$"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>S·ª≠ d·ª•ng b·∫£ng nguy√™n h√†m c∆° b·∫£n: $\\displaystyle \\int \\cos x dx = \\sin x + C$. <br>Ki·ªÉm tra l·∫°i: $(\\sin x + C)' = \\cos x$ (ƒê√∫ng)." },
        { part: 1, type: 'v1', num: 3, q: "T√¨m h·ªç nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = 5^x$.", a: ["$5^x + C$", "$5^x \\ln 5 + C$", "$\\displaystyle \\dfrac{5^x}{\\ln 5} + C$", "$\\displaystyle \\dfrac{5^{x+1}}{x+1} + C$"], c: "Mg==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>√Åp d·ª•ng c√¥ng th·ª©c nguy√™n h√†m h√†m s·ªë m≈©: $\\displaystyle \\int a^x dx = \\dfrac{a^x}{\\ln a} + C$. V·ªõi $a=5$, ta c√≥ k·∫øt qu·∫£ l√† $\\displaystyle \\dfrac{5^x}{\\ln 5} + C$." },
        { part: 1, type: 'v1', num: 4, q: "Cho h√†m s·ªë $f(x)$ x√°c ƒë·ªãnh tr√™n $K$ v√† $F(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa $f(x)$ tr√™n $K$. Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng?", a: ["$f'(x) = F(x)$", "$F'(x) = f(x)$", "$F(x) = f(x)$", "$F'(x) = f'(x)$"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>D·ª±a v√†o ƒë·ªãnh nghƒ©a nguy√™n h√†m: H√†m s·ªë $F(x)$ l√† nguy√™n h√†m c·ªßa $f(x)$ tr√™n $K$ n·∫øu ƒë·∫°o h√†m c·ªßa h√†m nguy√™n h√†m b·∫±ng h√†m s·ªë d∆∞·ªõi d·∫•u t√≠ch ph√¢n: $F'(x) = f(x)$." },
        { part: 1, type: 'v1', num: 5, q: "T√¨m $\\displaystyle \\int \\dfrac{1}{x^2} dx$.", a: ["$\\displaystyle \\dfrac{1}{x} + C$", "$\\displaystyle -\\dfrac{1}{x} + C$", "$\\displaystyle \\dfrac{1}{2x} + C$", "$\\ln x^2 + C$"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Vi·∫øt d∆∞·ªõi d·∫°ng l≈©y th·ª´a: $\\displaystyle \\dfrac{1}{x^2} = x^{-2}$.<br>√Åp d·ª•ng $\\displaystyle \\int x^n dx = \\dfrac{x^{n+1}}{n+1} + C$:<br>$\\displaystyle \\int x^{-2} dx = \\dfrac{x^{-1}}{-1} + C = -\\dfrac{1}{x} + C$." },
        { part: 1, type: 'v1', num: 6, q: "H·ªç c√°c nguy√™n h√†m c·ªßa h√†m s·ªë $f(x) = x^2 - 3x + \\dfrac{1}{x}$ l√†:", a: ["$F(x) = 2x - 3 - 1/x^2 + C$", "$\\displaystyle F(x) = \\dfrac{x^3}{3} - \\dfrac{3}{2}x^2 + \\ln |x| + C$", "$\\displaystyle F(x) = \\dfrac{x^3}{3} + \\dfrac{3}{2}x^2 + \\ln x + C$", "$\\displaystyle F(x) = \\dfrac{x^3}{3} - \\dfrac{3}{2}x^2 + \\ln x + C$"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>T√≠nh nguy√™n h√†m t·ª´ng s·ªë h·∫°ng:<br>1. $\\displaystyle \\int x^2 dx = \\dfrac{x^3}{3}$<br>2. $\\displaystyle \\int -3x dx = -\\dfrac{3x^2}{2}$<br>3. $\\displaystyle \\int \\dfrac{1}{x} dx = \\ln |x|$<br>H·ª£p l·∫°i ta c√≥ ph∆∞∆°ng √°n B." },
        { part: 1, type: 'v1', num: 7, q: "Cho h√†m s·ªë $y=f(x)$ li√™n t·ª•c tr√™n $K$ v√† $a, b, c \\in K$. M·ªánh ƒë·ªÅ n√†o sau ƒë√¢y <b>sai</b>?", a: ["$\\displaystyle \\int_a^b f(x)dx + \\int_c^b f(x)dx = \\int_a^c f(x)dx$", "$\\displaystyle \\int_a^b f(x)dx = \\int_a^b f(t)dt$", "$\\displaystyle \\int_a^b f(x)dx = -\\int_b^a f(x)dx$", "$\\displaystyle \\int_a^a f(x)dx = 0$"], c: "MA==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>M·ªánh ƒë·ªÅ A <b>Sai</b> v√¨ theo t√≠nh ch·∫•t n·ªëi c·∫≠n: $\\displaystyle \\int_a^c f(x)dx + \\int_c^b f(x)dx = \\int_a^b f(x)dx$.<br>·ªû ƒë√¢y v·∫ø tr√°i v√† v·∫ø ph·∫£i b·ªã ho√°n ƒë·ªïi logic." },
        { part: 1, type: 'v1', num: 8, q: "Cho $F(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa h√†m s·ªë $f(x)$. Khi ƒë√≥ hi·ªáu s·ªë $F(0)-F(1)$ b·∫±ng:", a: ["$\\displaystyle \\int_0^1 f(x)dx$", "$\\displaystyle \\int_0^1 F(x)dx$", "$\\displaystyle \\int_1^0 F(x)dx$", "$\\displaystyle \\int_1^0 f(x)dx$"], c: "Mw==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Theo ƒë·ªãnh l√Ω c∆° b·∫£n (Newton-Leibniz): $\\displaystyle \\int_a^b f(x)dx = F(b) - F(a)$.<br>ƒê·ªÉ thu ƒë∆∞·ª£c $F(0)-F(1)$, ta ch·ªçn c·∫≠n d∆∞·ªõi $a=1$, c·∫≠n tr√™n $b=0$." },
        { part: 1, type: 'v1', num: 9, q: "Cho $f(1)=2, f(3)=9$. T√≠nh $I = \\displaystyle \\int_1^3 f'(x)dx$.", a: ["11", "7", "2", "18"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>$\\displaystyle I = \\int_1^3 f'(x)dx = f(x) \\Big|_1^3 = f(3) - f(1)$.<br>Thay s·ªë: $I = 9 - 2 = 7$." },
        { part: 1, type: 'v1', num: 10, q: "Di·ªán t√≠ch h√¨nh ph·∫≥ng gi·ªõi h·∫°n b·ªüi $y=f(x)$, tr·ª•c ho√†nh v√† $x=a, x=b$ ($a < b$) l√†:", a: ["$\\displaystyle S = \\pi \\int_a^b f^2(x)dx$", "$\\displaystyle S = \\int_a^b f(x)dx$", "$\\displaystyle S = \\pi \\int_a^b |f(x)|dx$", "$\\displaystyle S = \\int_a^b |f(x)|dx$"], c: "Mw==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Di·ªán t√≠ch h√¨nh ph·∫≥ng gi·ªõi h·∫°n b·ªüi $y=f(x)$ v√† tr·ª•c ho√†nh $y=0$ lu√¥n l√† t√≠ch ph√¢n c·ªßa tr·ªã tuy·ªát ƒë·ªëi h√†m s·ªë tr√™n ƒëo·∫°n ƒëang x√©t." },
        { part: 1, type: 'v1', num: 11, q: "Kh·∫≥ng ƒë·ªãnh n√†o ƒë√∫ng v·ªÅ di·ªán t√≠ch $S$? <div class='img-container'><img src='cau11.png'></div>", a: ["$S = \\displaystyle \\int_a^b [f_2(x)-f_1(x)] dx$", "$\\displaystyle S = \\int_a^b [f_1(x)-f_2(x)] dx$", "$\\pi \\int [f_1-f_2]^2 dx$", "$\\pi \\int [f_1-f_2] dx$"], c: "MQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>D·ª±a v√†o ƒë·ªì th·ªã, tr√™n ƒëo·∫°n $[a,b]$, ƒë∆∞·ªùng $f_1(x)$ lu√¥n n·∫±m ph√≠a tr√™n ƒë∆∞·ªùng $f_2(x)$.<br>C√¥ng th·ª©c di·ªán t√≠ch gi·ªØa hai ƒë·ªì th·ªã l√†: $\\displaystyle S = \\int_a^b (y_{tren} - y_{duoi}) dx$." },
        { part: 1, type: 'v1', num: 12, q: "C√¥ng th·ª©c t√≠nh th·ªÉ t√≠ch $V$ gi·ªõi h·∫°n b·ªüi $x=a, x=b$ c√≥ di·ªán t√≠ch thi·∫øt di·ªán $S(x)$ l√†:", a: ["$V = \\int_b^a S(x)$", "$V = \\pi \\int S(x)$", "$V = \\pi \\int S^2(x)$", "$\\displaystyle V = \\int_a^b S(x)dx$"], c: "Mw==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>ƒê√¢y l√† c√¥ng th·ª©c t·ªïng qu√°t t√≠nh th·ªÉ t√≠ch v·∫≠t th·ªÉ theo thi·∫øt di·ªán ph·∫≥ng vu√¥ng g√≥c v·ªõi tr·ª•c $Ox$. C·∫ßn ph√¢n bi·ªát v·ªõi c√¥ng th·ª©c kh·ªëi tr√≤n xoay." },

        // PH·∫¶N II
        { 
            part: 2, type: 'v2', num: 1, q: "Cho $F(x)$ l√† nguy√™n h√†m c·ªßa $f(x) = \\dfrac{x^2+1}{x}$ tr√™n $(0;+\\infty)$. X√©t t√≠nh ƒë√∫ng/sai:", 
            items: [ {l: "$F(x) = f'(x)$", r: "ZmFsc2U="}, {l: "$F(x)+2025$ l√† nguy√™n h√†m c·ªßa $f(x)$", r: "dHJ1ZQ=="}, {l: "$F(x) = x^2 + \\ln x + 2025$", r: "ZmFsc2U="}, {l: "Bi·∫øt $F(1)=1.5 \\Rightarrow F(x)=x^2/2+2$", r: "ZmFsc2U="} ], 
            sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>‚Ä¢ <b>a: Sai.</b> V√¨ $F'(x)=f(x)$, kh√¥ng ph·∫£i $F(x)=f'(x)$.<br>‚Ä¢ <b>b: ƒê√∫ng.</b> N·∫øu $F(x)$ l√† nguy√™n h√†m th√¨ $F(x)+C$ c≈©ng l√† nguy√™n h√†m.<br>‚Ä¢ <b>c: Sai.</b> $\\displaystyle \\int (x + 1/x) dx = \\dfrac{x^2}{2} + \\ln x + C$. Bi·ªÉu th·ª©c ƒë·ªÅ cho sai h·ªá s·ªë $x^2$.<br>‚Ä¢ <b>d: Sai.</b> $F(1) = 1/2 + \\ln 1 + C = 1.5 \\Rightarrow C=1$. V·∫≠y $F(x) = \\dfrac{x^2}{2} + \\ln x + 1$." 
        },
        { 
            part: 2, type: 'v2', num: 2, q: "Cho $f(x)=6x^5-x^e$. G·ªçi $I = \\int 6x^5dx, J = \\int x^edx$. X√©t t√≠nh ƒë√∫ng/sai:", 
            items: [ {l: "$A = \\int x^5dx \\Rightarrow A=6I$", r: "ZmFsc2U="}, {l: "$\\int f(x)dx = I+J$", r: "ZmFsc2U="}, {l: "$J = b^e - a^e$", r: "ZmFsc2U="}, {l: "$\\int_0^1 f(x)dx = m - \\dfrac{n}{e+p} \\Rightarrow m+n+p=3$", r: "dHJ1ZQ=="} ], 
            sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>‚Ä¢ <b>a: Sai.</b> $I = 6A$. ‚Ä¢ <b>b: Sai.</b> $\\int (6x^5 - x^e) dx = I - J$. ‚Ä¢ <b>c: Sai.</b> $J$ l√† t√≠ch ph√¢n, ph·∫£i d√πng c√¥ng th·ª©c l≈©y th·ª´a.<br>‚Ä¢ <b>d: ƒê√∫ng.</b> $\\displaystyle \\int_0^1 f(x) dx = [x^6 - \\dfrac{x^{e+1}}{e+1}]_0^1 = 1 - \\dfrac{1}{e+1}$. Suy ra $m=1, n=1, p=1 \\Rightarrow m+n+p=3$." 
        },
        { 
            part: 2, type: 'v2', num: 3, q: "Cho h√†m s·ªë $f(x) = x+5-\\dfrac{6}{x}$ tr√™n $\\mathbb{R}\\backslash\\{0\\}$. X√©t t√≠nh ƒë√∫ng/sai:", 
            items: [ {l: "$f(x)$ l√† m·ªôt nguy√™n h√†m c·ªßa $g(x)=1+6/x^2$", r: "dHJ1ZQ=="}, {l: "$\\int f(x)dx = 0.5x^2+5x-6\\ln x + C$", r: "ZmFsc2U="}, {l: "N·∫øu $F(1)=5$ th√¨ $F(2)=5+\\int_1^2 f(x)dx$", r: "dHJ1ZQ=="}, {l: "$G(1)=4, G(2)+G(-1)=5 \\Rightarrow G(-6)=-13-6\\ln 3$", r: "dHJ1ZQ=="} ], 
            sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>‚Ä¢ <b>a: ƒê√∫ng.</b> ƒê·∫°o h√†m $f'(x) = 1 + 6/x^2 = g(x)$.<br>‚Ä¢ <b>b: Sai.</b> Thi·∫øu tr·ªã tuy·ªát ƒë·ªëi trong $\\ln|x|$.<br>‚Ä¢ <b>c, d: ƒê√∫ng.</b> √Åp d·ª•ng ƒë√∫ng c√¥ng th·ª©c t√≠ch ph√¢n x√°c ƒë·ªãnh v√† gi·∫£i h·ªá h·∫±ng s·ªë tr√™n t·ª´ng kho·∫£ng." 
        },
        { 
            part: 2, type: 'v2', num: 4, q: "Cho BBT ƒë·∫°o h√†m $f'(x)$ tr√™n $(0;+\\infty)$. <div class='img-container'><img src='cau4_ds.png'></div>", 
            items: [ {l: "$\\int_2^5 f'(x)dx = f(5)-f(2)$", r: "dHJ1ZQ=="}, {l: "$\\int_2^3 f'(x)dx = 1$", r: "ZmFsc2U="}, {l: "Di·ªán t√≠ch v√πng gi·ªõi h·∫°n l√† $0.5$", r: "ZmFsc2U="}, {l: "N·∫øu $\\int_2^5 |f'(x)|dx=5$ th√¨ $f(5)=5$", r: "ZmFsc2U="} ], 
            sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>‚Ä¢ <b>a: ƒê√∫ng.</b> C√¥ng th·ª©c c∆° b·∫£n.<br>‚Ä¢ <b>b: Sai.</b> $f'(x) < 0$ tr√™n $(2,3)$ n√™n t√≠ch ph√¢n kh√¥ng th·ªÉ l√† s·ªë d∆∞∆°ng $1$.<br>‚Ä¢ <b>d: Sai.</b> Ch·ªâ suy ra ƒë∆∞·ª£c $f(2)+f(5)=3$." 
        },

        // PH·∫¶N III
        { part: 3, type: 'v3', num: 1, q: "Bi·∫øt $\\displaystyle \\int (\\sin x - \\cos x)^2 dx = x + \\dfrac{1}{a} \\cos bx + C$. T√≠nh $S = a+b$.", c: "NA==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Khai tri·ªÉn h·∫±ng ƒë·∫≥ng th·ª©c: $(\\sin x - \\cos x)^2 = \\sin^2 x + \\cos^2 x - 2\\sin x \\cos x = 1 - \\sin 2x$.<br>Nguy√™n h√†m: $\\displaystyle \\int (1 - \\sin 2x) dx = x + \\dfrac{1}{2} \\cos 2x + C$.<br>ƒê·ªëi chi·∫øu h·∫±ng s·ªë: $a=2, b=2 \\Rightarrow a+b=4$." },
        { part: 3, type: 'v3', num: 2, q: "Cho $\\displaystyle \\int_2^7[2f(x)+3g(x)]=2$ v√† $\\displaystyle \\int_2^7[f(x)-2g(x)]=4$. T√≠nh $\\displaystyle \\int_2^7[f(x)-g(x)]$. (L√†m tr√≤n 2 ch·ªØ s·ªë TP).", c: "My4xNA==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Gi·∫£i h·ªá ph∆∞∆°ng tr√¨nh v·ªõi $A = \\int f(x)dx$ v√† $B = \\int g(x)dx$:<br>$\\begin{cases} 2A + 3B = 2 \\\\ A - 2B = 4 \\end{cases} \\Rightarrow \\begin{cases} A = 16/7 \\\\ B = -6/7 \\end{cases}$.<br>T√≠nh $A - B = 16/7 - (-6/7) = 22/7 \\approx 3.14$." },
        { part: 3, type: 'v3', num: 3, q: "Cho $F(x)=(ax^2+bx+c)e^x$ l√† nguy√™n h√†m c·ªßa $f(x)=(x^2+1)e^x$. T√≠nh $a+b+c$.", c: "Mg==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>ƒê·∫°o h√†m $F'(x) = [ax^2 + (2a+b)x + (b+c)]e^x$.<br>ƒê·ªìng nh·∫•t v·ªõi $(x^2+1)e^x \\Rightarrow a=1, 2a+b=0, b+c=1 \\Rightarrow a=1, b=-2, c=3$.<br>V·∫≠y $a+b+c=2$." },
        { part: 3, type: 'v3', num: 4, q: "Cho h√†m s·ªë $\\displaystyle f(x) = \\begin{cases} 3x^2-x-9 & \\text{khi } x \\ge 2 \\\\ x-1 & \\text{khi } x < 2 \\end{cases}$. T√≠nh $\\displaystyle I = \\int_0^3 f(x)dx$.", c: "Ny41", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br>Chia t√≠ch ph√¢n t·∫°i ƒëi·ªÉm n·ªëi $x=2$:<br>$\\displaystyle I = \\int_0^2 (x-1)dx + \\int_2^3 (3x^2-x-9)dx = 0 + 7.5 = 7.5$." },
        { part: 3, type: 'v3', num: 5, q: "T√≠nh $f(3)$ d·ª±a tr√™n di·ªán t√≠ch $S_A=4, S_B=10$ v√† $f(0)=2$. <div class='img-container'><img src='cau5_kq.png'></div>", c: "LTQ=", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br><div class='img-container'><img src='cau5_kq_lg.png'></div><br>$\\displaystyle f(3) = f(0) + \\int_0^3 f'(x)dx = 2 + (S_A - S_B) = 2 + 4 - 10 = -4$." },
        { part: 3, type: 'v3', num: 6, q: "T√≠nh ti·ªÅn tr·ªìng hoa (ngh√¨n ƒë·ªìng) gi·ªõi h·∫°n b·ªüi $y=x^2$ v√† $y=\\sqrt{20-x^2}$ (250k/$m^2$). <div class='img-container'><img src='cau6_kq.png'></div>", c: "NDk4NQ==", 
          sol: "<b>H·ªá th·ªëng AI ph√¢n t√≠ch:</b><br><div class='img-container'><img src='cau6_kq_lg.png'></div><br>1. Giao ƒëi·ªÉm $x = \\pm 2$.<br>2. Di·ªán t√≠ch $\\displaystyle S = \\int_{-2}^2 (\\sqrt{20-x^2}-x^2)dx \\approx 19.9396 m^2$.<br>3. Ti·ªÅn = $19.9396 \\times 250 \\approx 4985$ ngh√¨n ƒë·ªìng." }
    ];

    function startGame() {
        const input = document.getElementById('studentName').value;
        if(!input.trim()) return alert("H·ªçc sinh vui l√≤ng nh·∫≠p h·ªç t√™n!");
        studentName = input;
        document.getElementById('nameModal').style.display = 'none';
        document.getElementById('student-display').innerText = "H·ªçc sinh: " + studentName;
        const grid = document.getElementById('grid'); grid.innerHTML = "";
        for(let i=0; i<24; i++) {
            let t = document.createElement('div'); t.className='tile'; t.id='tile-'+i; grid.appendChild(t);
        }
        render();
    }

    function render() {
        const q = questions[currentIdx];
        const pInfo = document.getElementById('part-info');
        const qTitle = document.getElementById('q-title');
        
        if(q.part === 1) pInfo.innerHTML = "PH·∫¶N I. TR·∫ÆC NGHI·ªÜM 4 PH∆Ø∆†NG √ÅN. Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 12.";
        else if(q.part === 2) pInfo.innerHTML = "PH·∫¶N II. TR·∫ÆC NGHI·ªÜM ƒê√öNG SAI. Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 4.";
        else pInfo.innerHTML = "PH·∫¶N III. TR·∫ÆC NGHI·ªÜM TR·∫¢ L·ªúI NG·∫ÆN. Th√≠ sinh tr·∫£ l·ªùi t·ª´ c√¢u 1 ƒë·∫øn c√¢u 6.";

        qTitle.innerText = "C√¢u " + q.num + ".";
        document.getElementById('total-q').innerText = currentIdx + 1;
        document.getElementById('q-text').innerHTML = q.q;
        const zone = document.getElementById('ans-zone');
        zone.innerHTML = ''; 
        selectedV1 = null; userAns = ""; v2Ans = new Array(4).fill(null);

        if(q.type === 'v1') {
            q.a.forEach((opt, i) => {
                let b = document.createElement('button'); b.className='btn'; b.innerHTML = opt;
                b.onclick = () => { document.querySelectorAll('.btn').forEach(el=>el.classList.remove('selected')); b.classList.add('selected'); selectedV1 = i; };
                zone.appendChild(b);
            });
        } else if(q.type === 'v2') {
            q.items.forEach((item, i) => {
                let d = document.createElement('div'); d.className='tf-row';
                d.innerHTML = `<div style='flex:1'>${['a','b','c','d'][i]}) ${item.l}</div><div style='display:flex;gap:5px'>
                    <button class='btn-tf' id='t-${i}' onclick='setV2(${i},true)'>ƒê√∫ng</button>
                    <button class='btn-tf' id='f-${i}' onclick='setV2(${i},false)'>Sai</button></div>`;
                zone.appendChild(d);
            });
        } else {
            zone.innerHTML = `<div style='display:flex; flex-direction:column; align-items:center; gap:10px;'>
                <div class='answer-display' id='disp'>- - -</div>
                <div class='numpad'>${[1,2,3,4,5,6,7,8,9,0,'.','-'].map(n=>`<button class='num-btn' onclick='press("${n}")'>${n}</button>`).join('')}
                <button class='num-btn' style='grid-column:span 3; background:var(--wrong)' onclick='press("C")'>X√ìA</button></div></div>`;
        }
        MathJax.typesetPromise();
    }

    function setV2(i, v) { v2Ans[i] = v;
        document.getElementById(`t-${i}`).className = v ? 'btn-tf active-t' : 'btn-tf';
        document.getElementById(`f-${i}`).className = !v ? 'btn-tf active-f' : 'btn-tf';
    }

    function press(v) { 
        if(v === 'C') userAns = ""; else if(userAns.length < 8) userAns += v;
        document.getElementById('disp').innerText = userAns || "- - -";
    }

    function openTile() { 
        const t = document.querySelectorAll('.tile:not(.open)');
        if(t.length) t[Math.floor(Math.random()*t.length)].classList.add('open');
    }

    function handleNext() {
        const q = questions[currentIdx];
        let correct = false;
        if(q.type === 'v1') { if(selectedV1 === null) return alert("Ch·ªçn ƒë√°p √°n ƒë√£!"); if(selectedV1.toString() === atob(q.c)) { score += 0.25; correct = true; } }
        else if(q.type === 'v2') { if(v2Ans.includes(null)) return alert("Ch·ªçn h·∫øt ƒëi em!"); let cCount = 0; q.items.forEach((it, i) => { if(v2Ans[i].toString() === atob(it.r)) cCount++; }); const pts = [0, 0.1, 0.25, 0.5, 1.0]; score += pts[cCount]; if(cCount === 4) correct = true; }
        else { if(!userAns) return alert("Nh·∫≠p s·ªë v√†o!"); if(userAns == atob(q.c)) { score += 0.5; correct = true; } }

        if(correct) openTile();
        document.getElementById('score').innerText = score.toFixed(2);
        currentIdx++;
        if(currentIdx < questions.length) render();
        else finish();
    }

    function finish() {
        document.getElementById('game-main').style.display = 'none';
        document.getElementById('final-area').style.display = 'block';
        document.getElementById('final-score-display').innerText = "ƒêi·ªÉm s·ªë t√≠ch l≈©y: " + score.toFixed(2) + " / 10";
        
        let html = "";
        questions.forEach((q, i) => {
            let pText = q.part === 1 ? "PH·∫¶N I" : (q.part === 2 ? "PH·∫¶N II" : "PH·∫¶N III");
            html += `<div class='sol-card' id='sol-card-${i}'>
                <b style='color:var(--gold)'>${pText} - C√¢u ${q.num}:</b> ${q.q}
                <button class='ai-btn' onclick='toggleAI(${i})'><span>ü§ñ</span> AI PH√ÇN T√çCH & GI·∫¢I CHI TI·∫æT</button>
                <div class='ai-sol-box' id='ai-box-${i}'>
                    <div class='mathjax-process'>${q.sol}</div>
                    <button class='screenshot-btn' onclick='takeShot(${i})'>üì∏ CH·ª§P L·ªúI GI·∫¢I N√ÄY</button>
                </div>
            </div>`;
        });
        document.getElementById('sol-content').innerHTML = html;
        document.querySelectorAll('.tile').forEach(t => t.classList.add('open'));
        MathJax.typesetPromise();
        fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ name: studentName, score: score.toFixed(2) }) });
    }

    function toggleAI(idx) {
        let box = document.getElementById('ai-box-'+idx);
        box.style.display = (box.style.display === 'block') ? 'none' : 'block';
    }

    function takeShot(idx) {
        html2canvas(document.getElementById('sol-card-'+idx)).then(canvas => {
            let link = document.createElement('a');
            link.download = 'LoiGiai_Cau' + (idx+1) + '.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
</html>
